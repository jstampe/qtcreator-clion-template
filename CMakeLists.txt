cmake_minimum_required(VERSION 3.3)
project(qtcreator-clion-template)

find_package(Qt5 REQUIRED COMPONENTS Core Widgets Gui)

set(CMAKE_CXX_FLAGS "${CMAKE_CXX_FLAGS} -std=c++11")

#Pull needed header files generated by QT first
set(QT_GENERATED qtGenerated)
add_custom_target(${QT_GENERATED})
#Get all header files in the directory
file(GLOB QT_GEN_HEADERS ./build/*.h)
file(GLOB QT_CPP_GENERATED ./build/*.cpp)
#Copy them to the project dir
foreach(QT_GEN_HEADERS ${QT_GEN_HEADERS})
    add_custom_command(TARGET ${QT_GENERATED} PRE_BUILD COMMAND
            ${CMAKE_COMMAND} -E copy_if_different
            ${QT_GEN_HEADERS} ${CMAKE_SOURCE_DIR})
endforeach()

include_directories(${qtcreator-clion-template_SOURCE_DIR}/build)

set(SOURCE_FILES
        ${QT_GEN_HEADERS}
        ${QT_CPP_GENERATED}
        main.cpp
        mainwindow.cpp
        mainwindow.h)


add_executable(qtcreator-clion-template ${SOURCE_FILES})
add_dependencies(${PROJECT_NAME} ${QT_GENERATED})
target_link_libraries(qtcreator-clion-template ${QT_LIBRARIES} Qt5::Core Qt5::Widgets Qt5::Gui)
